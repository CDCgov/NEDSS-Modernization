services:
  modernization-api:
    build:
      context: ./
      dockerfile: ./apps/modernization-api/Dockerfile
    container_name: modernization-api
    environment:
      - NBS_DATASOURCE_SERVER=nbs-mssql
      - NBS_ELASTICSEARCH_SERVER=elasticsearch
      - NBS_WILDFLY_SERVER=wildfly:7001
      - NBS_UI_FEATURES_ADDRESS_AUTOCOMPLETE=false
      - NBS_UI_FEATURES_ADDRESS_VERIFICATION=false
      - NBS_UI_FEATURES_PAGEBUILDER_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_UI_FEATURES_PAGEBUILDER_PAGE_LIBRARY_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_UI_FEATURES_PAGEBUILDER_PAGE_MANAGEMENT_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_UI_FEATURES_PAGEBUILDER_PAGE_MANAGEMENT_CREATE_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_UI_FEATURES_PAGEBUILDER_PAGE_MANAGEMENT_EDIT_ENABLED=${PAGEBUILDER_ENABLED:-true}
    networks:
      - nbs

  pagebuilder-api:
    build:
      context: ./
      dockerfile: ./apps/question-bank/Dockerfile
    container_name: pagebuilder-api
    environment:
      - NBS_DATASOURCE_SERVER=nbs-mssql
    networks:
      - nbs

  nbs-gateway:
    build:
      context: ./
      dockerfile: ./apps/nbs-gateway/Dockerfile
    container_name: nbs-gateway
    environment:
      - NBS_GATEWAY_LOG_LEVEL=${NBS_GATEWAY_LOG_LEVEL:-INFO}
      - NBS_GATEWAY_CLASSIC=http://wildfly:7001
      - NBS_GATEWAY_PATIENT_SEARCH_SERVICE=${NBS_GATEWAY_PATIENT_SEARCH_SERVICE:-reverse-proxy:8080}
      - NBS_GATEWAY_PATIENT_PROFILE_SERVICE=${NBS_GATEWAY_PATIENT_PROFILE_SERVICE:-reverse-proxy:8080}
      - NBS_GATEWAY_PAGEBUILDER_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_GATEWAY_PAGEBUILDER_PAGE_LIBRARY_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_GATEWAY_PAGEBUILDER_PAGE_MANAGEMENT_ENABLED=${PAGEBUILDER_ENABLED:-true}
      - NBS_GATEWAY_PAGEBUILDER_SERVICE=${NBS_GATEWAY_PAGEBUILDER_SERVICE:-reverse-proxy:8080}
    networks:
      - nbs

networks:
  nbs:
    name: nbs
    external: true      
