Feature: Create Tab Service

  Scenario: Create a new tab successfully
     Given a user with ID 123
     And a valid tab creation request with the following details:
       | Page ID   | Name      | Visible |
       | 1000376L  | Local Tab | T       |
     When the user creates a new tab
     Then the service should create the tab successfully
     And the service should return a response with the message "Tab Created Successfully"

  Scenario: Attempt to create a new tab with hidden functionality
    Given a user with ID 10000000
    And an hidden tab with the name "Hidden Tab"
    When the user attempts to create a new tab with the following details:
      | Page      | Name           | Visible |
      | 1000270L  | Hidden Tab   | F  |
    Then the system should not display the hidden tab when saved and submitted

  Scenario: Attempt to create a new tab with missing data
   Given a user with ID 123
   And an incomplete tab creation request with missing details:
     | Page ID   | Name | Visible |
     | 1000376L  |      | T       |
   When the user attempts to create a new tab
   Then the service should throw an AddTabException with an appropriate error message

 Scenario: Handle exception during tab creation
   Given a user with ID 123
   And an invalid tab creation request (null request)
   When the user attempts to create a new tab
   Then the service should encounter an exception during tab creation
   And the service should throw an AddTabException with an appropriate error message


 Scenario: Retrieve tab metadata for the next order number
   Given a user with ID 123
   And a valid tab creation request with the following details:
     | Page      | Name        | Visible |
     | 1000376L  | Local Tab 2 | T       |
   And there are existing tabs or sections with different order numbers for the same page in the repository
   When the user creates a new tab
   Then the service should retrieve the highest order number for the page from the repository
   And the service should calculate the next order number for the new tab accordingly

 Scenario: Calculate next order number when no existing tabs exist for the page
   Given a user with ID 123
   And a valid tab creation request with the following details:
     | Page      | Name           | Visible |
     | 1000376L  | Local Tab New  | T       |
   And there are no existing tabs for the page in the repository
   When the user creates a new tab
   Then the service should calculate the next order number for the new tab

 Scenario: Handle repository failure during tab creation
   Given a user with ID 123
   And a valid tab creation request with the following details:
     | Page      | Name           | Visible |
     | 1000376L  | Local Tab Test | T       |
   And the WaUiMetaDataRepository fails to save the tab metadata
   When the user creates a new tab
   Then the service should encounter a failure when saving the tab metadata to the repository
   And the service should throw an AddTabException with an appropriate error message
