name: Build NBS6 Windows Container Build
env:
  container_name_env: "nbs6"
  nbs6_version_env: "6.0.15.1"
  dockerfile_relative_path_env: "./cdc-sandbox/nbs6-win-container/"
  zip_file_name_env: "v7.2.2.NEDSS.NBS.Modernized.Documentation.zip"
  user_guide_doc_name_env: "NBS 7.2.2 User Guide.docx"
on:
  workflow_dispatch:
    inputs: 
        container_name:
          description: "Name of container in ECR. Example: cdc-nbs-classic/<Container-Name>"
          type: string
          required: true
          default: ${{ vars.container_name_env }}
        nbs6_version:
          description: "NBS6 Version. This will be used to pull NBS ZIP from S3 Bucker in Shared Account and Tag Docker Image"
          type: string
          required: true
          default: ${{ vars.nbs6_version_env }}
        dockerfile_relative_path:
          description: "Relative path to dockerfile being built (use '-f' docker argument if the dockerfile referenced from the root directory)."
          type: string
          required: true
          default: ${{ vars.dockerfile_relative_path_env }} 
        zip_file_name:
          description: "Full zip file name and file format to be downloaded from latest Release Assets in Modernization Repository"
          type: string
          required: true
          default: ${{ vars.zip_file_name_env }}
        user_guide_doc_name:
          description: "Full user guide name with file format to be configured in NBS6 container. This will be overwritten to NBS User Training Guide.pdf"
          type: string
          required: true
          default: ${{ vars.user_guide_doc_name_env }}    
  push:
    branches:
      - main
    paths:
      - "cdc-sandbox/nbs6-win-container/**"
jobs:
  call-build-windows-container-workflow:
    name: Build Windows Container
    uses: CDCgov/NEDSS-Workflows/.github/workflows/Build-windows-container.yaml@nbs6-docker-image
    with:
      container_name: ${{ vars.container_name_env }}
      nbs6_version: ${{ vars.nbs6_version_env }}
      dockerfile_relative_path: ${{ vars.dockerfile_relative_path_env }}
      zip_file_name: ${{ vars.zip_file_name_env }}
      user_guide_doc_name: ${{ vars.user_guide_doc_name_env }}
    secrets:
      CDC_NBS_SANDBOX_SHARED_SERVICES_ACCOUNTID: ${{secrets.CDC_NBS_SANDBOX_SHARED_SERVICES_ACCOUNTID}}
      ECR_CLASSIC_REPO_BASE_NAME: ${{secrets.ECR_CLASSIC_REPO_BASE_NAME}}
      CLASSIC_ZIP_S3_BUCKET: ${{secrets.CLASSIC_ZIP_S3_BUCKET}}
      USER_GUIDE_S3_BUCKET: ${{secrets.USER_GUIDE_S3_BUCKET}}