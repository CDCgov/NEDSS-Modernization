# Patient File Routes

The routing criteria that defines which requests should be intercepted by a modernized service.

## Incoming

Transforms requests to a Classic Patient Profile into an authenticated request that redirects to the Modernized Patient
Profile of the Patient identified by the `MPRUid` or `uid` request parameter.

| Criteria                                                                               | API Path                      | Description                                                                                             |
| -------------------------------------------------------------------------------------- | ----------------------------- | ------------------------------------------------------------------------------------------------------- |
| A POST request where the Query Parameter `ContextAction` with a value of `ViewFile`    | `/nbs/redirect/patient/file` | View a Patient Profile link within Classic NBS.                                                         |
| A POST request where the Query Parameter `ContextAction` with a value of `FileSummary` | `/nbs/redirect/patient/file` | View a Patient Profile link within Classic NBS                                                          |
| A GET request where the Query Parameter `ContextAction` with a value of `FileSummary`  | `/nbs/redirect/patient/file` | View a Patient Profile link within Classic NBS after Morbidity Report `Submit and Create Investigation` |

The Patient Profile can also be accessed through "View File" or "Return to File" links on events pages in NBS Classic.
These requests to not include any identifying information for the patient nor the event and rely on the value of either
the `Return-Patient` or `Patient-Action` cookie to properly route to the Modernized Patient Profile.

| Criteria                                                                                                                                                                    | API Path                                     | Description                                                                                               |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| Contains the Query Parameter `ContextAction` with a value of `ReturnToFileSummary`                                                                                          | `/nbs/redirect/patient/file/summary/return` | Return to the Patient Profile with the Summary tab active                                                 |
| Contains the Query Parameter `ContextAction` with a value of `ReturnToFileEvents`                                                                                           | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile with the Events tab active                                                  |
| Path is exactly `/nbs/SelectCondition1.do` containing the Query Parameter `ContextAction` with a value of `Cancel`                                                          | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile after cancelling an `Add investigation`                                     |
| Path is exactly `/nbs/PageAction.do` containing the Query Parameter `method` with a value of `mergeSubmit` and the Query Parameter `ContextAction` with a value of `Submit` | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile after completing a `Compare investigation`                                  |
| Path is exactly `/nbs/AddObservationMorb2.do` containing the Query Parameter `ContextAction` with a value of `Cancel`                                                       | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile after cancelling an `Add morbidity report`                                  |
| Path is exactly `/nbs/AddObservationLab2.do` containing the Query Parameter `ContextAction` with a value of `Cancel`                                                        | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile after cancelling an `Add lab report`                                        |
| Path is exactly `/nbs/SelectCondition4.do` containing the Query Parameter `ContextAction` with a value of `Cancel`                                                          | `/nbs/redirect/patient/file/events/return`  | Return to the Patient Profile after cancelling an `Add lab report` with `Submit and Create Investigation` |

## Outgoing

Transforms requests to return to a Classic Profile into an authenticated request that redirects to the Modernized
Patient Profile of the Patient identified by the value of the `Return-Patient` cookie. This cookie added to requests via
an API call prior to redirecting to Classic NBS.

| Criteria                                                                                                                                                                                                           | API Path                                        | Description                                                                                                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| A POST request where the Path is exactly `/nbs/AddObservationMorb2.do` without any Query Parameters.                                                                                                               | `/nbs/redirect/patient/report/morbidity/submit` | Submitting a Morbidity Report after completing the Classic form displayed when a Morbidity Report is added from the Patient Profile |
| A POST request where the Path is exactly `/nbs/AddObservationLab2.do` containing the Query Parameter `ContextAction` with a value of `Submit`                                                                      | `/nbs/redirect/patient/report/lab/submit`       | Submitting a Lab Report after completing the Classic form displayed when a Lab Report is added from the Patient Profile             |
| A POST request where the Path is exactly `/nbs/PageAction.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileEvents` and the Query Parameter `method` with a value of `deleteSubmit`  | `/nbs/redirect/patient/investigation/delete`    | Deleting an Investigation after using Classic NBS to create an Investigation                                                        |
| A POST request where the Path is exactly `/nbs/PageAction.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileSummary` and the Query Parameter `method` with a value of `deleteSubmit` | `/nbs/redirect/patient/investigation/delete`    | Deleting an Investigation after navigating to an existing Investigation from the Patient Profile                                    |
| A POST request where the Path is exactly `/nbs/PamAction.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileEvents` and the Query Parameter `method` with a value of `deleteSubmit`   | `/nbs/redirect/patient/investigation/delete`    | Deleting a PAM Investigation after using Classic NBS to create a PAM Investigation                                                  |
| A POST request where the Path is exactly `/nbs/PamAction.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileSummary` and the Query Parameter `method` with a value of `deleteSubmit`  | `/nbs/redirect/patient/investigation/delete`    | Deleting a PAM Investigation after navigating to an existing PAM Investigation from the Patient Profile                             |
| A GET request where the Path is exactly `/nbs/ViewInvestigation3.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileEvents` and the Query Parameter `delete` with a value of `true`   | `/nbs/redirect/patient/investigation/delete`    | Deleting a Legacy Investigation after using Classic NBS to create a Legacy Investigation                                            |
| A GET request where the Path is exactly `/nbs/ViewInvestigation1.do` containing the Query Parameter `ContextAction` with a value of `ReturnToFileSummary` and the Query Parameter `delete` with a value of `true`  | `/nbs/redirect/patient/investigation/delete`    | Deleting a Legacy Investigation after navigating to an existing Legacy Investigation from the Patient Profile                       |
| A POST request where the Path is exactly `/nbs/PageAction.do` containing the Query Parameter `ContextAction` with a value of `Submit` and the Query Parameter `method` with a value of `mergeSubmit`               | `/nbs/redirect/patient/investigation/merge`     | Merging an Investigation after using Classic NBS to compare two Investigations.                                                     |
